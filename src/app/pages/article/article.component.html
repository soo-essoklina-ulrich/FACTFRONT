<p-toast/>
<div class="card">
    @if (loading) {
        <app-loader/>
    } @else {
        <p-table

            [value]="articlesList"
            [rows]="10"
            [rowsPerPageOptions]="[10, 25, 50]"
            [paginator]="true"
            stripedRows
            [tableStyle]="{'min-width': '50rem'}"
        >
            <ng-template #caption>
                <div class="flex justify-between items-center mb-3">

                    <input
                        pInputText
                        type="text"
                        (input)="filterGlobal($event)"
                        placeholder="Recherche un Article"/>

                    <div class="flex justify-around items-center ">
                        <p-button
                            class="mx-1"
                            pTooltip="Ajouter un Article"
                            tooltipPosition="top"
                            icon="fa-solid fa-plus"
                            (click)="showAddArticleModal()"
                        />
                        <p-button
                            class="mx-1"
                            pTooltip="Recharge les Articles"
                            tooltipPosition="top"
                            icon="fa-solid fa-refresh"
                            (click)="getArticles()"
                        />

                    </div>
                </div>
            </ng-template>
            <ng-template #header>
                <tr>
                    <th>#</th>
                    <th>Libelle</th>
                    <th>Prix Unitaire</th>
                    <th>Action</th>
                </tr>

            </ng-template>
            <ng-template #body let-article let-index="rowIndex">


                <tr>
                    <td>
                        {{ index + 1 }}
                    </td>
                    <td>
                        {{ article.libelle }}
                    </td>
                    <td>

              <span class="ml-1 vertical-align-middle">
                    {{ article.prix_unitaire }}
                </span>
                    </td>
                    <td>
                        <div class=" flex items-center  justify-start">
                            <i
                                class="pi pi-pencil mx-1 cursor-pointer" style="color: blue"
                                (click)="editArticle(article.id)"
                            ></i>
                            <i
                                class="pi pi-trash mx-1 cursor-pointer" style="color: red"
                                (click)="deleteArticle(article.id)"
                            ></i>
                        </div>

                    </td>

                </tr>


            </ng-template>
            <ng-template pTemplate="emptymessage">
                <tr class="text-center">
                    <td colspan="4">
                        <p class="justify-center items-center font-medium text-center">No articles found.</p>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    }
</div>


<p-dialog
    header="Ajout Article"
    [(visible)]="visibleaddmoal"
    [style]="{ width: '25vw' }"
    [modal]="true"
    [resizable]="false"
    [baseZIndex]="10000"
>
    <div class="card">
        <div class="card-body">
            <form [formGroup]="form" (ngSubmit)="OnSubmit()">
                <div class="mb-6">
                    <label for="input-label-with-helper-text"
                           class="block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2">Libelle</label>
                    <input pInputText type="text" id="input-label-with-helper-text" formControlName="libelle"
                           class="w-full md:w-full "
                           aria-describedby="hs-input-helper-text">


                    <p *ngIf="form.get('libelle')?.errors?.['required'] && form.get('libelle')?.touched"
                       class="text-sm text-red-500  text-gray-400 opacity-75 mt-2" id="hs-input-helper-text">
                        ce champ est obligatoire
                    </p>


                </div>
                <div class="mb-6">
                    <label for="input-label-with-helper-text1"
                           class="block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2">Prix
                        Unitaire</label>
                    <p-input-number type="number" id="input-label-with-helper-text1" formControlName="prix_unitaire"
                           class="w-full md:w-full "
                                    aria-describedby="hs-input-helper-text"></p-input-number>


                    <p *ngIf="form.get('prix_unitaire')?.errors?.['required'] && form.get('prix_unitaire')?.touched"
                       class="text-sm text-red-500  text-gray-400 opacity-75 mt-2" id="hs-input-helper-text">
                        ce champ est obligatoire
                    </p>

                </div>

                <p-button type="submit" icon="pi pi-plus" [hidden]="!form.valid"></p-button>
            </form>
        </div>
    </div>

</p-dialog>

<p-dialog
    header="Edit Article"
    [(visible)]="visibleeditmoal"
    [style]="{ width: '25vw' }"
    [modal]="true"
    [resizable]="false"
    [baseZIndex]="10000"
    (onHide)="form.reset()"
>
    @if (article) {
        <form [formGroup]="form" (ngSubmit)="UpdataeArticle()">
            <div class="mb-6">
                <label for="input-label-with-helper-text"
                       class="block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2">Libelle</label>
                <input pInputText type="text" id="input-label-with-helper-text" formControlName="libelle"
                       class="w-full md:w-full "
                       aria-describedby="hs-input-helper-text">


                <p *ngIf="form.get('libelle')?.errors?.['required'] && form.get('libelle')?.touched"
                   class="text-sm text-red-500  text-gray-400 opacity-75 mt-2" id="hs-input-helper-text">
                    ce champ est obligatoire
                </p>


            </div>
            <div class="mb-6">
                <label for="input-label-with-helper-text1"
                       class="block text-surface-900 dark:text-surface-0 text-xl font-medium mb-2">Prix Unitaire</label>
                <input pInputText type="number" id="input-label-with-helper-text1" formControlName="prix_unitaire"
                       class="w-full md:w-full "
                       aria-describedby="hs-input-helper-text">


                <p *ngIf="form.get('prix_unitaire')?.errors?.['required'] && form.get('prix_unitaire')?.touched"
                   class="text-sm text-red-500  text-gray-400 opacity-75 mt-2" id="hs-input-helper-text">
                    ce champ est obligatoire
                </p>

            </div>

            <p-button type="submit" label="Update" [hidden]="!form.valid"></p-button>
        </form>
    }

</p-dialog>
